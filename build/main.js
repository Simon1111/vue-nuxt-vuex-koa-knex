require("source-map-support/register"),module.exports=function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=10)}([function(e,t){e.exports=require("nuxt")},function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("http")},function(e,t){e.exports={development:{client:"pg",connection:{host:"127.0.0.1",port:"5432",user:"postgres",password:"1",database:"chat"},pool:{min:0,max:7}}}},function(e,t,o){e.exports=function(e){var t=o(7)(e),n=o(8);return n.prototype.paginate=function(e,t){var o={},n=t||1;n<1&&(n=1);var s=(n-1)*(e=e||10);return Promise.all([this.clone().count("* as count").first(),this.offset(s).limit(e)]).then(([t,r])=>{var i=t.count;r=r;return o.total=i,o.per_page=e,o.offset=s,o.to=s+r.length,o.last_page=Math.ceil(i/e),o.current_page=n,o.from=s,o.data=r,o})},t.queryBuilder=function(){return new n(t.client)},t}},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("knex")},function(e,t){e.exports=require("knex/lib/query/builder")},function(e,t){e.exports={head:{title:"SS-web project",meta:[{charset:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{hid:"description",name:"description",content:"description"}],link:[{rel:"icon",type:"image/x-icon",href:"/favicon.ico"}]},loading:{color:"#ffffff"},css:["~/node_modules/bootstrap/dist/css/bootstrap.min.css"],modules:["@nuxtjs/axios"],plugins:[{src:"~/plugins/socket.io.js",ssr:!1}],build:{extend(e,{isDev:t,isClient:o}){t&&o&&e.module.rules.push({enforce:"pre",test:/\.(js|vue)$/,loader:"eslint-loader",exclude:/(node_modules)/})}}}},function(e,t,o){"use strict";o.r(t);var n=o(0),s=o(1),r=o(2),i=o.n(r),a=o(3),u=o.n(a),c=o(4),l=o(5);const p=new i.a,d=l(c.development),f=process.env.HOST||"127.0.0.2",g=process.env.PORT||4e3,m=u.a.createServer(p.callback()),y=new s;y.get("/api/messages",async(e,t)=>{e.body=JSON.stringify(await d.select().from("messages"))}),y.get("/api/posts",async(e,t)=>{const o=isNaN(e.query.page)?1:e.query.page,n=["id","url","pagetitle","status","title","created_on"],s=JSON.stringify(await d("posts").select(n).groupBy(n).orderBy("title").paginate(3,o));e.body=void 0!==e.query.page&&isNaN(e.query.page)?[]:s}),y.get("/api/posts/:path",async(e,t)=>{const o=isNaN(e.params.path)?"url":"id";e.body=JSON.stringify(await d("posts").select().where(o,e.params.path))}),y.post("/api/auth",async(e,t)=>{const o=JSON.stringify(await d("users").select("email").where("email","admin@mail.ru"));console.log(o),e.body={token:"token",role:2}});var v=y;const x=o(6)(m);x.sockets.on("connection",e=>{console.log("a user connected: "+e.id),e.join("messages"),e.on("message",e=>{b(e),x.to("messages").emit("message",e.message)}),e.join("statuses"),e.on("status",e=>{d("posts").where({id:e.id}).update("status",e.status).then(()=>{console.log(e)}),x.to("statuses").emit("status",e.status)})});const b=e=>{e.idroom="messages",d.insert([e],["id"]).into("messages").then(()=>{console.log(e)})};!async function(){const e=o(9);e.dev=!("production"===p.env);const t=new n.Nuxt(e);if(e.dev){const e=new n.Builder(t);await e.build()}p.use(v.routes()).use(e=>{e.status=200,e.respond=!1,e.req.ctx=e,t.render(e.req,e.res)}),m.listen(g,f),console.log("Server listening on "+f+":"+g)}()}]);
//# sourceMappingURL=main.map